@if (!loading) {
  <div class="edit-quiz-page animate-fade-down">

    <div class="page-header">
      <button class="btn-back" (click)="cancel()">
        <i class="fas fa-arrow-left"></i> Quay l·∫°i
      </button>
    </div>

    <div class="form-card">
      <div class="card-header">
        <h2><i class="fas fa-edit"></i> Ch·ªânh s·ª≠a b·ªô c√¢u h·ªèi</h2>
        <p>C·∫≠p nh·∫≠t th√¥ng tin chi ti·∫øt cho b·ªô c√¢u h·ªèi #{{ bo_cau_hoi_id }}</p>
      </div>

      <form #editForm="ngForm" (ngSubmit)="onSubmit(editForm)" autocomplete="off">
        <div class="card-body">
          <div class="form-section">
            <h3 class="section-title">Th√¥ng tin chung</h3>
            <div class="form-group">
              <label>Ti√™u ƒë·ªÅ <span class="required">*</span></label>
              <input type="text" name="tieu_de" [(ngModel)]="dto.tieu_de" required maxlength="100" class="form-input"/>
            </div>
            <div class="form-group">
              <label>M√¥ t·∫£ ng·∫Øn</label>
              <textarea name="mo_ta" [(ngModel)]="dto.mo_ta" rows="3" maxlength="255" class="form-textarea"></textarea>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Ch·ªß ƒë·ªÅ <span class="required">*</span></label>

              <div class="custom-dropdown-container">
                <div class="dropdown-trigger" (click)="toggleChuDeDropdown()">
        <span class="selected-text" [class.placeholder]="!dto.chu_de_id">
          {{ getSelectedChuDeName() }}
        </span>
                  <i class="fas fa-chevron-down arrow-icon" [class.rotate]="showChuDeDropdown"></i>
                </div>

                @if (showChuDeDropdown) {
                  <div class="dropdown-options-list animate-fade-down">
                    @for (cd of chu_des; track cd.id) {
                      <div class="dropdown-item"
                           [class.active]="dto.chu_de_id === cd.id"
                           (click)="selectChuDe(cd.id)">
                        {{ cd.ten }}
                      </div>
                    }
                  </div>
                  <div class="backdrop-click" (click)="closeAllDropdowns()"></div>
                }
              </div>
            </div>

            <div class="form-group">
              <label>Ch·∫ø ƒë·ªô hi·ªÉn th·ªã</label>

              <div class="custom-dropdown-container">
                <div class="dropdown-trigger" (click)="toggleCheDoDropdown()">
                  <span class="selected-text">{{ getSelectedCheDoName() }}</span>
                  <i class="fas fa-chevron-down arrow-icon" [class.rotate]="showCheDoDropdown"></i>
                </div>

                @if (showCheDoDropdown) {
                  <div class="dropdown-options-list animate-fade-down">
                    <div class="dropdown-item"
                         [class.active]="dto.che_do_hien_thi === 'RIENG_TU'"
                         (click)="selectCheDo('RIENG_TU')">
                      üîí Private (D√πng ƒë·ªÉ t·ªï ch·ª©c thi ƒë·∫•u)
                    </div>
                    <div class="dropdown-item"
                         [class.active]="dto.che_do_hien_thi === 'CONG_KHAI'"
                         (click)="selectCheDo('CONG_KHAI')">
                      üåç Public (C√¥ng khai cho m·ªçi ng∆∞·ªùi)
                    </div>
                  </div>
                  <div class="backdrop-click" (click)="closeAllDropdowns()"></div>
                }
              </div>
            </div>
          </div>
          <div class="form-group">
            <label class="section-label">M·ª•c ƒë√≠ch s·ª≠ d·ª•ng <span class="required">*</span></label>
            <div class="selection-grid">
              @for (opt of loaiSuDungOptions; track opt.value) {
                <div class="selection-card"
                     [class.selected]="dto.loai_su_dung === opt.value"
                     (click)="dto.loai_su_dung = opt.value">
                  <input type="radio" name="loai_su_dung" [value]="opt.value" [(ngModel)]="dto.loai_su_dung" hidden>

                  <div class="check-icon"><i class="fas fa-check-circle"></i></div>
                  <div class="card-icon" [ngClass]="getIconColor(opt.value)"><i class="fas" [ngClass]="opt.icon"></i>
                  </div>

                  <div class="card-info">
                    <h4>{{ opt.label }}</h4>
                    <p>{{ getUsageDesc(opt.value) }}</p>
                  </div>
                </div>
              }
            </div>
          </div>

          <div class="form-group">
            <label class="section-label">Lo·∫°i ph√≠ tham gia</label>
            <div class="selection-grid two-cols">
              <div class="selection-card"
                   [class.selected]="!dto.muon_tao_tra_phi"
                   (click)="dto.muon_tao_tra_phi = false">
                <div class="check-icon"><i class="fas fa-check-circle"></i></div>
                <div class="card-icon green"><i class="fas fa-gift"></i></div>
                <div class="card-info">
                  <h4>Mi·ªÖn ph√≠</h4>
                  <p>Kh√¥ng thu ph√≠ ng∆∞·ªùi tham gia.</p>
                </div>
              </div>
              <div class="selection-card"
                   [class.selected]="dto.muon_tao_tra_phi"
                   (click)="dto.muon_tao_tra_phi = true">
                <div class="check-icon"><i class="fas fa-check-circle"></i></div>
                <div class="card-icon orange"><i class="fas fa-coins"></i></div>
                <div class="card-info">
                  <h4>Tr·∫£ ph√≠ (Premium)</h4>
                  <p>Thu ph√≠ v√†ng khi m·ªü kh√≥a.</p>
                </div>
              </div>
            </div>
          </div>

        </div>

        <div class="card-footer">
          <button type="button" class="btn-cancel" (click)="cancel()">H·ªßy b·ªè</button>
          <button type="submit" class="btn-submit" [disabled]="saving || editForm.invalid">
            @if (saving) {
              <i class="fas fa-spinner fa-spin"></i> ƒêang l∆∞u...
            } @else {
              <i class="fas fa-save"></i> L∆∞u thay ƒë·ªïi
            }
          </button>
        </div>
      </form>
    </div>
  </div>
} @else {
  <div class="loading-screen">
    <div class="spinner"></div>
    <p>ƒêang t·∫£i d·ªØ li·ªáu...</p>
  </div>
}
